connect = require 'connect'
flatiron = require 'flatiron'
mule = require '../lib/mule'

env = process.env
app = flatiron.app

app.use flatiron.plugins.http,
  before: [
    connect.cookieParser(),
    mule.sessions()
  ]

app.router.path /\//, mule.root
  secure: env.NODE_ENV is 'production'
  db:
    host:     env.MULEDB_HOST
    port:     Number env.MULEDB_PORT
    name:     env.MULEDB_NAME
    user:     env.MULEDB_USER
    password: env.MULEDB_PASSWORD

app.start 8080

# Local Variables:
# mode: coffee
# end:
